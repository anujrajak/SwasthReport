{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/anujrajak/Learn/Pathology/patho-client/lib/db/mongodb.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nif (!process.env.MONGODB_URI) {\n  throw new Error(\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\n  );\n}\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\n// Use global variable in development to prevent multiple connections\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nconst cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(\"MongoDB connected successfully\");\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MACR;AAEJ;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAY3C,MAAM,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE7E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///Users/anujrajak/Learn/Pathology/patho-client/lib/db/models/user.ts"],"sourcesContent":["import mongoose, { Schema, Model } from \"mongoose\";\nimport connectDB from \"../mongodb\";\n\nexport interface IUser {\n  name: string;\n  email: string;\n  image?: string;\n  emailVerified?: boolean;\n  googleId?: string;\n  createdAt: Date;\n  updatedAt: Date;\n  lastLoginAt?: Date;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      trim: true,\n    },\n    image: {\n      type: String,\n    },\n    emailVerified: {\n      type: Boolean,\n      default: false,\n    },\n    googleId: {\n      type: String,\n      unique: true,\n      sparse: true, // Allows multiple null values\n    },\n    lastLoginAt: {\n      type: Date,\n    },\n  },\n  {\n    timestamps: true, // Automatically adds createdAt and updatedAt\n  }\n);\n\n// Create indexes\nUserSchema.index({ email: 1 }, { unique: true });\nUserSchema.index({ googleId: 1 }, { unique: true, sparse: true });\nUserSchema.index({ createdAt: 1 });\n\n// Get or create User model\nlet User: Model<IUser>;\n\nif (mongoose.models.User) {\n  User = mongoose.models.User as Model<IUser>;\n} else {\n  User = mongoose.model<IUser>(\"User\", UserSchema);\n}\n\nexport interface CreateUserInput {\n  name: string;\n  email: string;\n  image?: string;\n  emailVerified?: boolean;\n  googleId?: string;\n}\n\n/**\n * Find user by email\n */\nexport async function findUserByEmail(email: string): Promise<IUser | null> {\n  await connectDB();\n  return User.findOne({ email: email.toLowerCase().trim() });\n}\n\n/**\n * Find user by Google ID\n */\nexport async function findUserByGoogleId(\n  googleId: string\n): Promise<IUser | null> {\n  await connectDB();\n  return User.findOne({ googleId });\n}\n\n/**\n * Create a new user\n */\nexport async function createUser(input: CreateUserInput): Promise<IUser> {\n  await connectDB();\n  const user = new User({\n    name: input.name,\n    email: input.email.toLowerCase().trim(),\n    image: input.image,\n    emailVerified: input.emailVerified ?? false,\n    googleId: input.googleId,\n    lastLoginAt: new Date(),\n  });\n\n  return user.save();\n}\n\n/**\n * Update user information\n */\nexport async function updateUser(\n  userId: string,\n  updates: Partial<CreateUserInput>\n): Promise<IUser | null> {\n  await connectDB();\n  return User.findByIdAndUpdate(\n    userId,\n    {\n      ...updates,\n      lastLoginAt: new Date(),\n    },\n    { new: true, runValidators: true }\n  );\n}\n\n/**\n * Find or create user (upsert)\n */\nexport async function findOrCreateUser(\n  input: CreateUserInput\n): Promise<IUser> {\n  await connectDB();\n\n  // Try to find by Google ID first\n  if (input.googleId) {\n    const existingUser = await findUserByGoogleId(input.googleId);\n    if (existingUser) {\n      // Update user info and last login\n      return (\n        (await updateUser(existingUser._id.toString(), {\n          name: input.name,\n          email: input.email,\n          image: input.image,\n          emailVerified: input.emailVerified,\n        })) || existingUser\n      );\n    }\n  }\n\n  // Try to find by email\n  const existingUser = await findUserByEmail(input.email);\n  if (existingUser) {\n    // Update user info and last login\n    return (\n      (await updateUser(existingUser._id.toString(), {\n        name: input.name,\n        email: input.email,\n        image: input.image,\n        emailVerified: input.emailVerified,\n        googleId: input.googleId,\n      })) || existingUser\n    );\n  }\n\n  // Create new user\n  return createUser(input);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAaA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,OAAO;QACL,MAAM;IACR;IACA,eAAe;QACb,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,aAAa;QACX,MAAM;IACR;AACF,GACA;IACE,YAAY;AACd;AAGF,iBAAiB;AACjB,WAAW,KAAK,CAAC;IAAE,OAAO;AAAE,GAAG;IAAE,QAAQ;AAAK;AAC9C,WAAW,KAAK,CAAC;IAAE,UAAU;AAAE,GAAG;IAAE,QAAQ;IAAM,QAAQ;AAAK;AAC/D,WAAW,KAAK,CAAC;IAAE,WAAW;AAAE;AAEhC,2BAA2B;AAC3B,IAAI;AAEJ,IAAI,oHAAQ,CAAC,MAAM,CAAC,IAAI,EAAE;IACxB,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI;AAC7B,OAAO;IACL,OAAO,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;AACvC;AAaO,eAAe,gBAAgB,KAAa;IACjD,MAAM,IAAA,iKAAS;IACf,OAAO,KAAK,OAAO,CAAC;QAAE,OAAO,MAAM,WAAW,GAAG,IAAI;IAAG;AAC1D;AAKO,eAAe,mBACpB,QAAgB;IAEhB,MAAM,IAAA,iKAAS;IACf,OAAO,KAAK,OAAO,CAAC;QAAE;IAAS;AACjC;AAKO,eAAe,WAAW,KAAsB;IACrD,MAAM,IAAA,iKAAS;IACf,MAAM,OAAO,IAAI,KAAK;QACpB,MAAM,MAAM,IAAI;QAChB,OAAO,MAAM,KAAK,CAAC,WAAW,GAAG,IAAI;QACrC,OAAO,MAAM,KAAK;QAClB,eAAe,MAAM,aAAa,IAAI;QACtC,UAAU,MAAM,QAAQ;QACxB,aAAa,IAAI;IACnB;IAEA,OAAO,KAAK,IAAI;AAClB;AAKO,eAAe,WACpB,MAAc,EACd,OAAiC;IAEjC,MAAM,IAAA,iKAAS;IACf,OAAO,KAAK,iBAAiB,CAC3B,QACA;QACE,GAAG,OAAO;QACV,aAAa,IAAI;IACnB,GACA;QAAE,KAAK;QAAM,eAAe;IAAK;AAErC;AAKO,eAAe,iBACpB,KAAsB;IAEtB,MAAM,IAAA,iKAAS;IAEf,iCAAiC;IACjC,IAAI,MAAM,QAAQ,EAAE;QAClB,MAAM,eAAe,MAAM,mBAAmB,MAAM,QAAQ;QAC5D,IAAI,cAAc;YAChB,kCAAkC;YAClC,OACE,AAAC,MAAM,WAAW,aAAa,GAAG,CAAC,QAAQ,IAAI;gBAC7C,MAAM,MAAM,IAAI;gBAChB,OAAO,MAAM,KAAK;gBAClB,OAAO,MAAM,KAAK;gBAClB,eAAe,MAAM,aAAa;YACpC,MAAO;QAEX;IACF;IAEA,uBAAuB;IACvB,MAAM,eAAe,MAAM,gBAAgB,MAAM,KAAK;IACtD,IAAI,cAAc;QAChB,kCAAkC;QAClC,OACE,AAAC,MAAM,WAAW,aAAa,GAAG,CAAC,QAAQ,IAAI;YAC7C,MAAM,MAAM,IAAI;YAChB,OAAO,MAAM,KAAK;YAClB,OAAO,MAAM,KAAK;YAClB,eAAe,MAAM,aAAa;YAClC,UAAU,MAAM,QAAQ;QAC1B,MAAO;IAEX;IAEA,kBAAkB;IAClB,OAAO,WAAW;AACpB"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///Users/anujrajak/Learn/Pathology/patho-client/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport { findOrCreateUser } from \"@/lib/db/models/user\";\n\nexport const authOptions = {\n  // Using JWT sessions (no database adapter needed for NextAuth v4)\n  session: {\n    strategy: \"jwt\",\n  },\n  providers: [\n    GoogleProvider({\n      clientId: process.env.AUTH_GOOGLE_ID || process.env.GOOGLE_CLIENT_ID,\n      clientSecret:\n        process.env.AUTH_GOOGLE_SECRET || process.env.GOOGLE_CLIENT_SECRET,\n    }),\n  ],\n  secret: process.env.AUTH_SECRET || process.env.NEXTAUTH_SECRET,\n  pages: {\n    signIn: \"/\",\n  },\n  callbacks: {\n    async signIn({ user, account, profile }) {\n      // Save/update user in MongoDB using Mongoose\n      if (account?.provider === \"google\" && user.email && user.name) {\n        try {\n          await findOrCreateUser({\n            name: user.name,\n            email: user.email,\n            image: user.image || undefined,\n            emailVerified: profile?.email_verified || false,\n            googleId: account.providerAccountId,\n          });\n        } catch (error) {\n          console.error(\"Error saving user to database:\", error);\n          // Don't block sign in if user save fails\n        }\n      }\n      return true;\n    },\n    async redirect({ url, baseUrl }) {\n      // Allows relative callback URLs\n      if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n      // Allows callback URLs on the same origin\n      if (new URL(url).origin === baseUrl) return url;\n      return baseUrl;\n    },\n  },\n};\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,cAAc;IACzB,kEAAkE;IAClE,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,IAAA,8ZAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI,QAAQ,GAAG,CAAC,gBAAgB;YACpE,cACE,QAAQ,GAAG,CAAC,kBAAkB,IAAI,QAAQ,GAAG,CAAC,oBAAoB;QACtE;KACD;IACD,QAAQ,QAAQ,GAAG,CAAC,WAAW,IAAI,QAAQ,GAAG,CAAC,eAAe;IAC9D,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACrC,6CAA6C;YAC7C,IAAI,SAAS,aAAa,YAAY,KAAK,KAAK,IAAI,KAAK,IAAI,EAAE;gBAC7D,IAAI;oBACF,MAAM,IAAA,iLAAgB,EAAC;wBACrB,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,OAAO,KAAK,KAAK,IAAI;wBACrB,eAAe,SAAS,kBAAkB;wBAC1C,UAAU,QAAQ,iBAAiB;oBACrC;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,kCAAkC;gBAChD,yCAAyC;gBAC3C;YACF;YACA,OAAO;QACT;QACA,MAAM,UAAS,EAAE,GAAG,EAAE,OAAO,EAAE;YAC7B,gCAAgC;YAChC,IAAI,IAAI,UAAU,CAAC,MAAM,OAAO,GAAG,UAAU,KAAK;YAClD,0CAA0C;YAC1C,IAAI,IAAI,IAAI,KAAK,MAAM,KAAK,SAAS,OAAO;YAC5C,OAAO;QACT;IACF;AACF;AAEA,MAAM,UAAU,IAAA,gZAAQ,EAAC"}}]
}